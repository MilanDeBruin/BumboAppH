@using Bumbo.Domain.Models;
@using Bumbo.App.Web.Models.ViewModels.Home;


@model Bumbo.App.Web.Models.ViewModels.Home.WeekPersonalScheduleViewModel

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/rooster_bekijken.css">
</head>


<body>
    <div>
        @if (!Model.isSick)
        {
            <a asp-controller="Home" asp-action="Ziekmelden" asp-route-employeeId="@User.FindFirst("employee_id")?.Value">
                <input type="button" value="Ziekmelden" class="btn btn-secondary"/>
            </a>
        }
        else
        {
            <a asp-controller="Home" asp-action="Ziekmelden">
                <input type="button" value="Ziekgemeld" disabled="disabled" class="btn btn-secondary" />
            </a>
        }
        <h2>Rooster Week</h2>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success text-center mt-3">
            @TempData["SuccessMessage"]
        </div>
    }

    <div class="d-flex align-items-center gap-3 border p-3 rounded shadow-sm">
        <a asp-controller="Home"
           asp-action="Index"
           asp-route-date="@Model.FirstDayOfWeek.AddDays(-7).ToString("yyyy-MM-dd")"
           asp-route-employeeId="@User.FindFirst("employee_id")?.Value"
           class="btn btn-secondary">
            Week terug
        </a>



        <span class="fw-bold">@Model.FirstDayOfWeek.ToString("dd-MM-yyyy")</span>
        <span>tot</span>
        <span class="fw-bold">@Model.FirstDayOfWeek.AddDays(6).ToString("dd-MM-yyyy")</span>


        <a asp-controller="Home"
           asp-action="Index"
           asp-route-date="@Model.FirstDayOfWeek.AddDays(7).ToString("yyyy-MM-dd")"
           asp-route-employeeId="@User.FindFirst("employee_id")?.Value"
           class="btn btn-secondary">
            Week vooruit
        </a>
    </div>


    <div class="table-container">

        <table class="schedule-table">
            <thead>
                <tr>
                    <th>Datum</th>
                    <th>Tijd</th>
                    <th>Afdeling</th>
                    <th>Filiaal</th>
                    <th>Shift ruilen</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var daysOfWeek = Enumerable.Range(0, 7)
                    .Select(offset => Model.FirstDayOfWeek.AddDays(offset))
                    .ToList();
                }

                @foreach (var date in daysOfWeek)
                {
                    var daySchedule = Model.WorkDays.FirstOrDefault(d => d.Date == date);
                    if (daySchedule != null && daySchedule.Shifts.Any())
                    {
                        foreach (var shift in daySchedule.Shifts)
                        {
                            <tr>
                                <td>@date.ToString("dd-MM-yyyy")</td>
                                <td>@shift.StartTime.ToString("HH:mm") - @shift.EndTime.ToString("HH:mm")</td>
                                <td>@shift.Departement</td>
                                <td>@shift.Branch_Id</td>
                                @switch (shift.ShiftStatus)
                                {
                                    case "Requested":
                                        <td class="table-info">
                                            <p>Shift aangeboden</p>
                                        </td>
                                        ;
                                        break;
                                    case "Claimed":
                                        <td class="table-info">
                                            <p>Shift geclaimd. Wachten op goedkeuring</p>
                                        </td>
                                        ;
                                        break;    
                                    case "Accepted":
                                        <td class="table-success">
                                            <p>Verzoek tot ruilen goedgekeurd.</p>
                                        </td>
                                        ;
                                        break;
                                    case "Denied":
                                        <td class="table-danger">
                                            <p>Verzoek tot ruilen afgekeurd</p>
                                        </td>
                                        ;
                                        break;
                                    default:
                                        <td>
                                            <form method="post" asp-controller="ShiftTrading" asp-action="OfferShift">
                                                <input type="hidden" name="employee" value="@shift.EmployeeId"/>
                                                <input type="hidden" name="branch" value="@shift.Branch_Id"/>
                                                <input type="hidden" name="date" value="@date.ToString("dd-MM-yyyy")"/>
                                                <input type="hidden" name="startTime" value="@shift.StartTime.ToString("HH:mm:ss")"/>
                                                <button type="submit" class="btn btn-primary">Shift aanbieden</button>
                                            </form>
                                        </td>
                                        ;
                                        break;
                                }
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td>@date.ToString("dd-MM-yyyy")</td>
                            <td colspan="4">Geen diensten</td>
                        </tr>
                    }
                }
            </tbody>
        </table>

         @if (User.FindFirst("position")?.Value == "Manager")
         {
            <div class="sicktable-container">
                <h5>Zieke medewerkers van vandaag</h5>
                <div class="sicktable">
                    <table>
                        <thead>
                            <tr>
                                <th>Employee Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                var sickmodel = Model.sickListNames;
                            }
                            @foreach (var name in sickmodel)
                            {
                                <tr>
                                    <td>@name</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
         }
        </div>
    @if (Model.ingeklokt == false)
    {
        <a asp-controller="Home" asp-action="Inklokken" asp-route-employeeId="@User.FindFirst("employee_id")?.Value">
            <input type="button" value="Inklokken" class="btn btn-primary"/>
        </a>
    }
    else
    {
        <a asp-controller="Home" asp-action="Uitklokken" asp-route-employeeId="@User.FindFirst("employee_id")?.Value">
            <input type="button" value="Uitklokken" class="btn btn-primary" />
        </a>
    }
</body>
        
           
